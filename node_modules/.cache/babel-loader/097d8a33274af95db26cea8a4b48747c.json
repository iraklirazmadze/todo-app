{"ast":null,"code":"import process from 'node:process';\nimport readline from 'node:readline';\nimport { BufferListStream } from 'bl';\nconst ASCII_ETX_CODE = 0x03; // Ctrl+C emits this code\n\nexport class StdinDiscarder {\n  #requests = 0;\n  #mutedStream = new BufferListStream();\n  #ourEmit;\n  #rl;\n\n  constructor() {\n    this.#mutedStream.pipe(process.stdout);\n    const self = this; // eslint-disable-line unicorn/no-this-assignment\n\n    this.#ourEmit = function (event, data) {\n      const {\n        stdin\n      } = process;\n\n      for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n        args[_key - 2] = arguments[_key];\n      }\n\n      if (self.#requests > 0 || stdin.emit === self.#ourEmit) {\n        if (event === 'keypress') {\n          // Fixes readline behavior\n          return;\n        }\n\n        if (event === 'data' && data.includes(ASCII_ETX_CODE)) {\n          process.emit('SIGINT');\n        }\n\n        Reflect.apply(self.#ourEmit, this, [event, data, ...args]);\n      } else {\n        Reflect.apply(process.stdin.emit, this, [event, data, ...args]);\n      }\n    };\n  }\n\n  start() {\n    this.#requests++;\n\n    if (this.#requests === 1) {\n      this._realStart();\n    }\n  }\n\n  stop() {\n    if (this.#requests <= 0) {\n      throw new Error('`stop` called more times than `start`');\n    }\n\n    this.#requests--;\n\n    if (this.#requests === 0) {\n      this._realStop();\n    }\n  } // TODO: Use private methods when targeting Node.js 14.\n\n\n  _realStart() {\n    // No known way to make it work reliably on Windows\n    if (process.platform === 'win32') {\n      return;\n    }\n\n    this.#rl = readline.createInterface({\n      input: process.stdin,\n      output: this.#mutedStream\n    });\n    this.#rl.on('SIGINT', () => {\n      if (process.listenerCount('SIGINT') === 0) {\n        process.emit('SIGINT');\n      } else {\n        this.#rl.close();\n        process.kill(process.pid, 'SIGINT');\n      }\n    });\n  }\n\n  _realStop() {\n    if (process.platform === 'win32') {\n      return;\n    }\n\n    this.#rl.close();\n    this.#rl = undefined;\n  }\n\n}","map":{"version":3,"names":["process","readline","BufferListStream","ASCII_ETX_CODE","StdinDiscarder","requests","mutedStream","ourEmit","rl","constructor","pipe","stdout","self","event","data","stdin","args","emit","includes","Reflect","apply","start","_realStart","stop","Error","_realStop","platform","createInterface","input","output","on","listenerCount","close","kill","pid","undefined"],"sources":["/home/razma/node_modules/ora/utilities.js"],"sourcesContent":["import process from 'node:process';\nimport readline from 'node:readline';\nimport {BufferListStream} from 'bl';\n\nconst ASCII_ETX_CODE = 0x03; // Ctrl+C emits this code\n\nexport class StdinDiscarder {\n\t#requests = 0;\n\t#mutedStream = new BufferListStream();\n\t#ourEmit;\n\t#rl;\n\n\tconstructor() {\n\t\tthis.#mutedStream.pipe(process.stdout);\n\n\t\tconst self = this; // eslint-disable-line unicorn/no-this-assignment\n\t\tthis.#ourEmit = function (event, data, ...args) {\n\t\t\tconst {stdin} = process;\n\t\t\tif (self.#requests > 0 || stdin.emit === self.#ourEmit) {\n\t\t\t\tif (event === 'keypress') { // Fixes readline behavior\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (event === 'data' && data.includes(ASCII_ETX_CODE)) {\n\t\t\t\t\tprocess.emit('SIGINT');\n\t\t\t\t}\n\n\t\t\t\tReflect.apply(self.#ourEmit, this, [event, data, ...args]);\n\t\t\t} else {\n\t\t\t\tReflect.apply(process.stdin.emit, this, [event, data, ...args]);\n\t\t\t}\n\t\t};\n\t}\n\n\tstart() {\n\t\tthis.#requests++;\n\n\t\tif (this.#requests === 1) {\n\t\t\tthis._realStart();\n\t\t}\n\t}\n\n\tstop() {\n\t\tif (this.#requests <= 0) {\n\t\t\tthrow new Error('`stop` called more times than `start`');\n\t\t}\n\n\t\tthis.#requests--;\n\n\t\tif (this.#requests === 0) {\n\t\t\tthis._realStop();\n\t\t}\n\t}\n\n\t// TODO: Use private methods when targeting Node.js 14.\n\t_realStart() {\n\t\t// No known way to make it work reliably on Windows\n\t\tif (process.platform === 'win32') {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#rl = readline.createInterface({\n\t\t\tinput: process.stdin,\n\t\t\toutput: this.#mutedStream,\n\t\t});\n\n\t\tthis.#rl.on('SIGINT', () => {\n\t\t\tif (process.listenerCount('SIGINT') === 0) {\n\t\t\t\tprocess.emit('SIGINT');\n\t\t\t} else {\n\t\t\t\tthis.#rl.close();\n\t\t\t\tprocess.kill(process.pid, 'SIGINT');\n\t\t\t}\n\t\t});\n\t}\n\n\t_realStop() {\n\t\tif (process.platform === 'win32') {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#rl.close();\n\t\tthis.#rl = undefined;\n\t}\n}\n"],"mappings":"AAAA,OAAOA,OAAP,MAAoB,cAApB;AACA,OAAOC,QAAP,MAAqB,eAArB;AACA,SAAQC,gBAAR,QAA+B,IAA/B;AAEA,MAAMC,cAAc,GAAG,IAAvB,C,CAA6B;;AAE7B,OAAO,MAAMC,cAAN,CAAqB;EAC3B,CAACC,QAAD,GAAY,CAAZ;EACA,CAACC,WAAD,GAAe,IAAIJ,gBAAJ,EAAf;EACA,CAACK,OAAD;EACA,CAACC,EAAD;;EAEAC,WAAW,GAAG;IACb,KAAK,CAACH,WAAN,CAAkBI,IAAlB,CAAuBV,OAAO,CAACW,MAA/B;IAEA,MAAMC,IAAI,GAAG,IAAb,CAHa,CAGM;;IACnB,KAAK,CAACL,OAAN,GAAgB,UAAUM,KAAV,EAAiBC,IAAjB,EAAgC;MAC/C,MAAM;QAACC;MAAD,IAAUf,OAAhB;;MAD+C,kCAANgB,IAAM;QAANA,IAAM;MAAA;;MAE/C,IAAIJ,IAAI,CAAC,CAACP,QAAN,GAAiB,CAAjB,IAAsBU,KAAK,CAACE,IAAN,KAAeL,IAAI,CAAC,CAACL,OAA/C,EAAwD;QACvD,IAAIM,KAAK,KAAK,UAAd,EAA0B;UAAE;UAC3B;QACA;;QAED,IAAIA,KAAK,KAAK,MAAV,IAAoBC,IAAI,CAACI,QAAL,CAAcf,cAAd,CAAxB,EAAuD;UACtDH,OAAO,CAACiB,IAAR,CAAa,QAAb;QACA;;QAEDE,OAAO,CAACC,KAAR,CAAcR,IAAI,CAAC,CAACL,OAApB,EAA6B,IAA7B,EAAmC,CAACM,KAAD,EAAQC,IAAR,EAAc,GAAGE,IAAjB,CAAnC;MACA,CAVD,MAUO;QACNG,OAAO,CAACC,KAAR,CAAcpB,OAAO,CAACe,KAAR,CAAcE,IAA5B,EAAkC,IAAlC,EAAwC,CAACJ,KAAD,EAAQC,IAAR,EAAc,GAAGE,IAAjB,CAAxC;MACA;IACD,CAfD;EAgBA;;EAEDK,KAAK,GAAG;IACP,KAAK,CAAChB,QAAN;;IAEA,IAAI,KAAK,CAACA,QAAN,KAAmB,CAAvB,EAA0B;MACzB,KAAKiB,UAAL;IACA;EACD;;EAEDC,IAAI,GAAG;IACN,IAAI,KAAK,CAAClB,QAAN,IAAkB,CAAtB,EAAyB;MACxB,MAAM,IAAImB,KAAJ,CAAU,uCAAV,CAAN;IACA;;IAED,KAAK,CAACnB,QAAN;;IAEA,IAAI,KAAK,CAACA,QAAN,KAAmB,CAAvB,EAA0B;MACzB,KAAKoB,SAAL;IACA;EACD,CA9C0B,CAgD3B;;;EACAH,UAAU,GAAG;IACZ;IACA,IAAItB,OAAO,CAAC0B,QAAR,KAAqB,OAAzB,EAAkC;MACjC;IACA;;IAED,KAAK,CAAClB,EAAN,GAAWP,QAAQ,CAAC0B,eAAT,CAAyB;MACnCC,KAAK,EAAE5B,OAAO,CAACe,KADoB;MAEnCc,MAAM,EAAE,KAAK,CAACvB;IAFqB,CAAzB,CAAX;IAKA,KAAK,CAACE,EAAN,CAASsB,EAAT,CAAY,QAAZ,EAAsB,MAAM;MAC3B,IAAI9B,OAAO,CAAC+B,aAAR,CAAsB,QAAtB,MAAoC,CAAxC,EAA2C;QAC1C/B,OAAO,CAACiB,IAAR,CAAa,QAAb;MACA,CAFD,MAEO;QACN,KAAK,CAACT,EAAN,CAASwB,KAAT;QACAhC,OAAO,CAACiC,IAAR,CAAajC,OAAO,CAACkC,GAArB,EAA0B,QAA1B;MACA;IACD,CAPD;EAQA;;EAEDT,SAAS,GAAG;IACX,IAAIzB,OAAO,CAAC0B,QAAR,KAAqB,OAAzB,EAAkC;MACjC;IACA;;IAED,KAAK,CAAClB,EAAN,CAASwB,KAAT;IACA,KAAK,CAACxB,EAAN,GAAW2B,SAAX;EACA;;AA7E0B"},"metadata":{},"sourceType":"module"}